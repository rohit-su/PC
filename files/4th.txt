#include <stdio.h>
#include <stdlib.h>
#include <omp.h>
#include <math.h>

int is_prime(int x) {
    if (x < 2) return 0;
    if (x == 2) return 1;
    if (x % 2 == 0) return 0;
    int limit = (int)sqrt((double)x);
    for (int i = 3; i <= limit; i += 2)
        if (x % i == 0) return 0;
    return 1;
}

int main(int argc, char *argv[]) {
    if (argc != 2) return 1;
    int n = atoi(argv[1]);
    int count_serial = 0, count_parallel = 0;

    // Serial
    double t1 = omp_get_wtime();
    for (int i = 1; i <= n; i++)
        if (is_prime(i)) count_serial++;
    double t2 = omp_get_wtime();

    // Parallel
    double t3 = omp_get_wtime();
    #pragma omp parallel for reduction(+:count_parallel) schedule(static)
    for (int i = 1; i <= n; i++)
        if (is_prime(i)) count_parallel++;
    double t4 = omp_get_wtime();

    printf("Serial primes:   %d, time = %f s\n", count_serial, t2 - t1);
    printf("Parallel primes: %d, time = %f s\n", count_parallel, t4 - t3);

    return 0;
}
